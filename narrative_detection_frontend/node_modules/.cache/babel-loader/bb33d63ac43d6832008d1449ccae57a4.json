{"ast":null,"code":"var httpProxy = exports,\n    extend = require('util')._extend,\n    parse_url = require('url').parse,\n    EE3 = require('eventemitter3'),\n    http = require('http'),\n    https = require('https'),\n    web = require('./passes/web-incoming'),\n    ws = require('./passes/ws-incoming');\n\nhttpProxy.Server = ProxyServer;\n/**\n * Returns a function that creates the loader for\n * either `ws` or `web`'s  passes.\n *\n * Examples:\n *\n *    httpProxy.createRightProxy('ws')\n *    // => [Function]\n *\n * @param {String} Type Either 'ws' or 'web'\n * \n * @return {Function} Loader Function that when called returns an iterator for the right passes\n *\n * @api private\n */\n\nfunction createRightProxy(type) {\n  return function (options) {\n    return function (req, res\n    /*, [head], [opts] */\n    ) {\n      var passes = type === 'ws' ? this.wsPasses : this.webPasses,\n          args = [].slice.call(arguments),\n          cntr = args.length - 1,\n          head,\n          cbl;\n      /* optional args parse begin */\n\n      if (typeof args[cntr] === 'function') {\n        cbl = args[cntr];\n        cntr--;\n      }\n\n      if (!(args[cntr] instanceof Buffer) && args[cntr] !== res) {\n        //Copy global options\n        options = extend({}, options); //Overwrite with request options\n\n        extend(options, args[cntr]);\n        cntr--;\n      }\n\n      if (args[cntr] instanceof Buffer) {\n        head = args[cntr];\n      }\n      /* optional args parse end */\n\n\n      ['target', 'forward'].forEach(function (e) {\n        if (typeof options[e] === 'string') options[e] = parse_url(options[e]);\n      });\n\n      if (!options.target && !options.forward) {\n        return this.emit('error', new Error('Must provide a proper URL as target'));\n      }\n\n      for (var i = 0; i < passes.length; i++) {\n        /**\n         * Call of passes functions\n         * pass(req, res, options, head)\n         *\n         * In WebSockets case the `res` variable\n         * refer to the connection socket\n         * pass(req, socket, options, head)\n         */\n        if (passes[i](req, res, options, head, this, cbl)) {\n          // passes can return a truthy value to halt the loop\n          break;\n        }\n      }\n    };\n  };\n}\n\nhttpProxy.createRightProxy = createRightProxy;\n\nfunction ProxyServer(options) {\n  EE3.call(this);\n  options = options || {};\n  options.prependPath = options.prependPath === false ? false : true;\n  this.web = this.proxyRequest = createRightProxy('web')(options);\n  this.ws = this.proxyWebsocketRequest = createRightProxy('ws')(options);\n  this.options = options;\n  this.webPasses = Object.keys(web).map(function (pass) {\n    return web[pass];\n  });\n  this.wsPasses = Object.keys(ws).map(function (pass) {\n    return ws[pass];\n  });\n  this.on('error', this.onError, this);\n}\n\nrequire('util').inherits(ProxyServer, EE3);\n\nProxyServer.prototype.onError = function (err) {\n  //\n  // Remark: Replicate node core behavior using EE3\n  // so we force people to handle their own errors\n  //\n  if (this.listeners('error').length === 1) {\n    throw err;\n  }\n};\n\nProxyServer.prototype.listen = function (port, hostname) {\n  var self = this,\n      closure = function (req, res) {\n    self.web(req, res);\n  };\n\n  this._server = this.options.ssl ? https.createServer(this.options.ssl, closure) : http.createServer(closure);\n\n  if (this.options.ws) {\n    this._server.on('upgrade', function (req, socket, head) {\n      self.ws(req, socket, head);\n    });\n  }\n\n  this._server.listen(port, hostname);\n\n  return this;\n};\n\nProxyServer.prototype.close = function (callback) {\n  var self = this;\n\n  if (this._server) {\n    this._server.close(done);\n  } // Wrap callback to nullify server after all open connections are closed.\n\n\n  function done() {\n    self._server = null;\n\n    if (callback) {\n      callback.apply(null, arguments);\n    }\n  }\n\n  ;\n};\n\nProxyServer.prototype.before = function (type, passName, callback) {\n  if (type !== 'ws' && type !== 'web') {\n    throw new Error('type must be `web` or `ws`');\n  }\n\n  var passes = type === 'ws' ? this.wsPasses : this.webPasses,\n      i = false;\n  passes.forEach(function (v, idx) {\n    if (v.name === passName) i = idx;\n  });\n  if (i === false) throw new Error('No such pass');\n  passes.splice(i, 0, callback);\n};\n\nProxyServer.prototype.after = function (type, passName, callback) {\n  if (type !== 'ws' && type !== 'web') {\n    throw new Error('type must be `web` or `ws`');\n  }\n\n  var passes = type === 'ws' ? this.wsPasses : this.webPasses,\n      i = false;\n  passes.forEach(function (v, idx) {\n    if (v.name === passName) i = idx;\n  });\n  if (i === false) throw new Error('No such pass');\n  passes.splice(i++, 0, callback);\n};","map":{"version":3,"sources":["/home/zecheng3/workspace/narrative_dectection/narrative_detection_frontend/node_modules/cors-anywhere/node_modules/http-proxy/lib/http-proxy/index.js"],"names":["httpProxy","exports","extend","require","_extend","parse_url","parse","EE3","http","https","web","ws","Server","ProxyServer","createRightProxy","type","options","req","res","passes","wsPasses","webPasses","args","slice","call","arguments","cntr","length","head","cbl","Buffer","forEach","e","target","forward","emit","Error","i","prependPath","proxyRequest","proxyWebsocketRequest","Object","keys","map","pass","on","onError","inherits","prototype","err","listeners","listen","port","hostname","self","closure","_server","ssl","createServer","socket","close","callback","done","apply","before","passName","v","idx","name","splice","after"],"mappings":"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","sourcesContent":["var httpProxy = exports,\n    extend    = require('util')._extend,\n    parse_url = require('url').parse,\n    EE3       = require('eventemitter3'),\n    http      = require('http'),\n    https     = require('https'),\n    web       = require('./passes/web-incoming'),\n    ws        = require('./passes/ws-incoming');\n\nhttpProxy.Server = ProxyServer;\n\n/**\n * Returns a function that creates the loader for\n * either `ws` or `web`'s  passes.\n *\n * Examples:\n *\n *    httpProxy.createRightProxy('ws')\n *    // => [Function]\n *\n * @param {String} Type Either 'ws' or 'web'\n * \n * @return {Function} Loader Function that when called returns an iterator for the right passes\n *\n * @api private\n */\n\nfunction createRightProxy(type) {\n\n  return function(options) {\n    return function(req, res /*, [head], [opts] */) {\n      var passes = (type === 'ws') ? this.wsPasses : this.webPasses,\n          args = [].slice.call(arguments),\n          cntr = args.length - 1,\n          head, cbl;\n\n      /* optional args parse begin */\n      if(typeof args[cntr] === 'function') {\n        cbl = args[cntr];\n\n        cntr--;\n      }\n\n      if(\n        !(args[cntr] instanceof Buffer) &&\n        args[cntr] !== res\n      ) {\n        //Copy global options\n        options = extend({}, options);\n        //Overwrite with request options\n        extend(options, args[cntr]);\n\n        cntr--;\n      }\n\n      if(args[cntr] instanceof Buffer) {\n        head = args[cntr];\n      }\n\n      /* optional args parse end */\n\n      ['target', 'forward'].forEach(function(e) {\n        if (typeof options[e] === 'string')\n          options[e] = parse_url(options[e]);\n      });\n\n      if (!options.target && !options.forward) {\n        return this.emit('error', new Error('Must provide a proper URL as target'));\n      }\n\n      for(var i=0; i < passes.length; i++) {\n        /**\n         * Call of passes functions\n         * pass(req, res, options, head)\n         *\n         * In WebSockets case the `res` variable\n         * refer to the connection socket\n         * pass(req, socket, options, head)\n         */\n        if(passes[i](req, res, options, head, this, cbl)) { // passes can return a truthy value to halt the loop\n          break;\n        }\n      }\n    };\n  };\n}\nhttpProxy.createRightProxy = createRightProxy;\n\nfunction ProxyServer(options) {\n  EE3.call(this);\n\n  options = options || {};\n  options.prependPath = options.prependPath === false ? false : true;\n\n  this.web = this.proxyRequest           = createRightProxy('web')(options);\n  this.ws  = this.proxyWebsocketRequest  = createRightProxy('ws')(options);\n  this.options = options;\n\n  this.webPasses = Object.keys(web).map(function(pass) {\n    return web[pass];\n  });\n\n  this.wsPasses = Object.keys(ws).map(function(pass) {\n    return ws[pass];\n  });\n\n  this.on('error', this.onError, this);\n\n}\n\nrequire('util').inherits(ProxyServer, EE3);\n\nProxyServer.prototype.onError = function (err) {\n  //\n  // Remark: Replicate node core behavior using EE3\n  // so we force people to handle their own errors\n  //\n  if(this.listeners('error').length === 1) {\n    throw err;\n  }\n};\n\nProxyServer.prototype.listen = function(port, hostname) {\n  var self    = this,\n      closure = function(req, res) { self.web(req, res); };\n\n  this._server  = this.options.ssl ?\n    https.createServer(this.options.ssl, closure) :\n    http.createServer(closure);\n\n  if(this.options.ws) {\n    this._server.on('upgrade', function(req, socket, head) { self.ws(req, socket, head); });\n  }\n\n  this._server.listen(port, hostname);\n\n  return this;\n};\n\nProxyServer.prototype.close = function(callback) {\n  var self = this;\n  if (this._server) {\n    this._server.close(done);\n  }\n\n  // Wrap callback to nullify server after all open connections are closed.\n  function done() {\n    self._server = null;\n    if (callback) {\n      callback.apply(null, arguments);\n    }\n  };\n};\n\nProxyServer.prototype.before = function(type, passName, callback) {\n  if (type !== 'ws' && type !== 'web') {\n    throw new Error('type must be `web` or `ws`');\n  }\n  var passes = (type === 'ws') ? this.wsPasses : this.webPasses,\n      i = false;\n\n  passes.forEach(function(v, idx) {\n    if(v.name === passName) i = idx;\n  })\n\n  if(i === false) throw new Error('No such pass');\n\n  passes.splice(i, 0, callback);\n};\nProxyServer.prototype.after = function(type, passName, callback) {\n  if (type !== 'ws' && type !== 'web') {\n    throw new Error('type must be `web` or `ws`');\n  }\n  var passes = (type === 'ws') ? this.wsPasses : this.webPasses,\n      i = false;\n\n  passes.forEach(function(v, idx) {\n    if(v.name === passName) i = idx;\n  })\n\n  if(i === false) throw new Error('No such pass');\n\n  passes.splice(i++, 0, callback);\n};\n"]},"metadata":{},"sourceType":"script"}